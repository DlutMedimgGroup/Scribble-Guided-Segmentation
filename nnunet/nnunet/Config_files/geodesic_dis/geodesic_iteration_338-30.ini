; Time: 20220101
; Description: 尝试基于Scribble和测地线距离的迭代训练。
;              - 数据转换，用于convert_scribble_task_config，将原数据集中的数据和Scribble数据转化为标准的nnUNet_raw_data。

[Convert]
source_folder = /home/mingrui/disk1/projects/nnUNet/DATASET/nnUNet_raw/nnUNet_raw_data/Scribble38_Liver-30
output_task_name = Scribble338_Liver-30
plan_file_to_load = /home/mingrui/disk1/projects/nnUNet/DATASET/nnUNet_preprocessed/Task331_Liver

[Task]
gpus_id = 1
num_of_gpus = 1
; 任务名称的后缀，会新建文件夹来保存结果
task_name_suffix = geodesic_338-30
; 仅使用训练集中的前x例数据训练，设置为0表示不限制
limited_tr_keys = 0
; 仅使用训练集中x例数据训练时，数据的选取方式。f:前x例; r:随机
limited_tr_keys_mod = f


task_id = 338
fold = 0
; 通过一个splits_final.pkl文件指定验证集，不指定的话设置为None
validation_path = /home/mingrui/disk1/projects/nnUNet/DATASET/nnUNet_preprocessed/Task331_Liver/splits_final.pkl

network = 3d_fullres
network_trainer = nnUNetTrainerV2_geodisic

validation_only = False
; continue
continue_training = False
plans_identifier = default_plans_identifier
use_compressed_data = False
deterministic = False
dbs = False
npz = False
valbest = False
find_lr = False
fp32 = False
disable_saving = False

; 中间文件保存路径，用于debug
geodesic_cache = /home/mingrui/disk1/projects/nnUNet/DATASET/geodisic_cache/Scribble338_Liver-30

[Retrain]
; 对网络中的一部分重新训练 
retrain = True
; !!!!!!!! 训练前检查设置是否正确 !!!!!!!!
init_model = 3d_fullres/Task331_Liver/nnUNetTrainerV2_anatomy__nnUNetPlansv2.1_small_331/fold_0/model_final_checkpoint.model
reinit = False
;全部重新训练(微调)
retrain_layer = 11-0

[Predict]

input_folder = /home/mingrui/disk1/projects/nnUNet/DATASET/nnUNet_inference/Task331_Liver/input_test
; input_folder = /home/mingrui/disk1/projects/nnUNet/DATASET/nnUNet_raw/nnUNet_raw_data/Task003_Liver/imagesTr
output_folder = /home/mingrui/disk1/projects/nnUNet/DATASET/nnUNet_inference/Task331_Liver/scribble_338-30_best

folds = 0
save_npz = False
lowres_segmentations = None
part_id = 0
num_parts = 1
num_threads_preprocessing = 6
num_threads_nifti_save = 2
disable_tta = False
; disable_tta = True
overwrite_existing = False
mode = normal
; mode = fastest
all_in_gpu = None
step_size = 0.5
chk = model_best
; chk = model_latest
disable_mixed_precision = False